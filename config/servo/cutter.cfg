[gcode_macro CUT_FILAMENT]
gcode:
    {% set cutter = printer['gcode_macro _CUTTER_VARIABLES'] %}  
    
    {% if (printer.print_stats.state == "printing") %}
        PAUSE
    {% endif %}

    {% set temp_z = printer.toolhead.position.z|float %}
    Z_SAFE
    G0 X{cutter.safe_x} Y{cutter.safe_y} F{cutter.safe_speed*60}
    G0 X{cutter.cutting_x} Y{cutter.cutting_y} F{cutter.cutting_speed*60}
    G0 X{cutter.safe_x} Y{cutter.safe_y} F{cutter.cutting_speed*60}
    G0 X{cutter.end_x} Y{cutter.end_y} F{cutter.safe_speed*60}
    G0 Z{temp_z}
    
    {% if (printer.print_stats.state == "paused") %}
      RESUME
    {% endif %}
