{% set sensor = printer['gcode_macro _SENSOR_VARIABLES'] %}  
    {% if (printer.print_stats.state == "printing") %}
        {% if (sensor.enable_attempts_purge|lower == 'true') or (sensor.enable_attempts_purge|lower >= attempts) %} 
          ATTEMPT_PURGE
        {% else %}
        {% if (sensor.enable_attempts_purge|lower >= attempts) %} 
            {% if(sensor.disable_runnout|lower == 'false') %}
              filament_change_state1
            {% else %}
              M118 Filament runnout is disabled in the sensor config file! 
              M117 Filament runnout is disabled in the sensor config file! 
            {% endif %}  
        {% endif %}  
    {% else %}
    {% endif %}  
